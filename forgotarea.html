<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Reset Password - ScriptVault</title>
    <style>
        body { font-family: Arial, sans-serif; background: #1a1a1a; color: #fff; display: flex; justify-content: center; align-items: center; height: 100vh; }
        .box { background: #222; padding: 2em; border-radius: 8px; box-shadow: 0 0 12px #444; width: 320px; }
        input[type="password"], button { width: 100%; margin-top: 1em; padding: 0.8em; border-radius: 4px; border: none; }
        input[type="password"] { background: #111; color: #fff; }
        button { background: #2563eb; color: #fff; font-weight: bold; cursor: pointer; }
        .msg { margin-top: 1.2em; }
    </style>
</head>
<body>
<div class="box">
    <h2>Reset Your Password</h2>
    <input type="password" id="password" placeholder="New password">
    <button id="resetBtn">Reset Password</button>
    <div class="msg" id="msg"></div>
</div>
<script>
const token = new URLSearchParams(window.location.search).get('token')
const btn = document.getElementById('resetBtn')
const msg = document.getElementById('msg')
btn.onclick = async () => {
    const password = document.getElementById('password').value
    msg.innerText = ''
    btn.disabled = true
    if (!password) {
        msg.innerText = 'Enter a new password.'
        btn.disabled = false
        return
    }
    try {
        const r = await fetch('/api/reset-password', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ token, password })
        })
        const data = await r.json()
        if (r.ok) {
            msg.innerText = 'Password was reset. You can now log in.'
        } else {
            msg.innerText = data.error || 'Failed to reset password.'
        }
    } catch (e) {
        msg.innerText = 'Server error.'
    }
    btn.disabled = false
}
</script>
</body>
</html>
